<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>AUTO 369¬∞ ‚Äî –ø–æ—à—É–∫ —ñ –ø—Ä–æ–¥–∞–∂ –∞–≤—Ç–æ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no"/>
  <meta name="format-detection" content="telephone=no"/>
  <meta name="theme-color" content="#07142e"/>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: radial-gradient(1100px 800px at 50% 10%, #0a1f44 0%, #081939 42%, #07142e 100%);
      --paper:#fff; --ink:#000;
      --brand:#ffd33b; --brand-press:#ffbf00;
      --line:rgba(255,255,255,.14); --glass:rgba(12,20,44,.68);
      --field-bg:rgba(255,255,255,.08); --field-br:rgba(255,255,255,.22);
      --ph:rgba(255,255,255,.75);
      --menu-bg:#0b1635; --menu-br:rgba(255,255,255,.22); --menu-hover:rgba(255,255,255,.10);
      --top:60px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--paper); font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}

    /* Topbar */
    .topbar{ position:sticky; top:0; z-index:100; height:var(--top); display:flex; align-items:center; gap:10px; padding:10px 12px; background:linear-gradient(180deg, rgba(7,15,35,.95), rgba(7,15,35,.72)); border-bottom:1px solid var(--line); }
    .logo{background:var(--brand); color:#111; border-radius:12px; padding:8px 12px; font:700 16px/1 "Russo One",sans-serif;}
    .pill{display:inline-flex; align-items:center; gap:8px; height:38px; padding:0 12px; border-radius:12px; border:1px solid var(--line); background:rgba(255,255,255,.08); cursor:pointer; font-weight:700;}
    .pill.yellow{background:var(--brand); color:#111; border-color:rgba(0,0,0,.2); font-family:"Russo One"; text-transform:uppercase;}
    .grow{flex:1}

    .container{max-width:1200px; margin:12px auto; padding:0 12px;}
    .panel{background:var(--glass); border:1px solid var(--line); border-radius:16px; padding:12px; box-shadow:0 20px 40px rgba(0,0,0,.45); backdrop-filter:saturate(130%) blur(8px);}    

    /* Inputs */
    .filters{display:grid; grid-template-columns:repeat(6,1fr); gap:10px;}
    @media (max-width:1024px){ .filters{grid-template-columns:repeat(3,1fr);} }
    @media (max-width:640px){ .filters{grid-template-columns:1fr 1fr;} }
    label{font-size:12px; font-weight:800; opacity:.92; display:block; margin:0 0 6px;}
    .input,.select{ width:100%; height:46px; border-radius:12px; border:1px solid var(--field-br); background:var(--field-bg); color:#fff; padding:0 12px; font-size:14px; outline:none; }
    .input::placeholder{color:var(--ph)}
    .actions{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}
    .btn{height:48px; border:none; border-radius:14px; background:var(--brand); color:#111; font:700 16px/48px "Russo One"; padding:0 18px; cursor:pointer; box-shadow:0 6px 0 rgba(0,0,0,.35), inset 0 -3px 0 rgba(0,0,0,.18);}    
    .btn:active{transform:translateY(2px); background:var(--brand-press); box-shadow:0 4px 0 rgba(0,0,0,.35), inset 0 -2px 0 rgba(0,0,0,.18);}    
    .btn.ghost{background:rgba(255,255,255,.1); color:#fff;}

    /* Nice Select (desktop) ‚Äî PORTAL OVERLAY */
    @media (hover:hover){
      .select.nice-hidden{position:absolute; inset:0; opacity:0; pointer-events:none}
      .nice{position:relative}
      .nice-btn{ width:100%; height:46px; border-radius:12px; border:1px solid var(--field-br); background:var(--field-bg); color:#fff; padding:0 38px 0 12px; text-align:left; font-size:14px; font-weight:600; cursor:pointer; }
      .nice-btn:after{content:"‚ñæ"; position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.8; pointer-events:none}
      /* moved to body */
      .nice-list{ position:fixed; left:0; top:0; width:240px; background:var(--menu-bg); border:1px solid var(--menu-br); border-radius:12px; padding:6px; box-shadow:0 18px 38px rgba(0,0,0,.6); display:none; max-height:260px; overflow:auto; z-index:2147483647; }
      .nice-item{padding:10px 12px; border-radius:10px; cursor:pointer; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
      .nice-item:hover{background:var(--menu-hover)}
      .nice-item.active{background:rgba(255,255,255,.12)}
    }

    .topline{display:flex; align-items:center; gap:10px; margin:14px 0;}
    .grid{display:grid; grid-template-columns:repeat(3,1fr); gap:12px;}
    @media (max-width:1024px){ .grid{grid-template-columns:repeat(2,1fr);} }
    @media (max-width:640px){ .grid{grid-template-columns:1fr;} }

    .card{ background:rgba(255,255,255,.06); border:1px solid var(--line); border-radius:14px; overflow:hidden; display:flex; flex-direction:column; cursor:pointer; transition:transform .08s ease, box-shadow .08s ease; }
    .card:active{transform:translateY(1px); box-shadow:0 10px 22px rgba(0,0,0,.35)}
    .thumb{position:relative; padding-top:62%; background:#0b3a8a; overflow:hidden;}
    .thumb img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover;}
    .badge{position:absolute; left:8px; bottom:8px; background:var(--brand); color:#111; border-radius:10px; padding:6px 10px; font:700 14px/1 "Russo One";}
    .views{position:absolute; right:8px; bottom:8px; background:rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.25); color:#fff; border-radius:10px; padding:5px 8px; font-weight:700; font-size:12px}
    .body{padding:10px; display:flex; flex-direction:column; gap:6px}
    .title{font:700 16px/1.2 "Russo One"; letter-spacing:.4px}

    .detail{position:fixed; inset:0; z-index:120; display:none; background:rgba(0,0,0,.5);}    
    .detail.active{display:block;}
    .sheet{position:absolute; left:50%; top:6vh; transform:translateX(-50%); width:min(1080px,96vw); max-height:88vh; overflow:auto; background:var(--glass); border:1px solid var(--line); border-radius:16px; padding:12px; box-shadow:0 20px 40px rgba(0,0,0,.6); backdrop-filter:saturate(130%) blur(8px);}    

    /* Single-image gallery with arrows */
    .big{position:relative; padding-top:56%; background:#0b3a8a; border-radius:12px; overflow:hidden}
    .big img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
    .navBtn{position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,.45); color:#fff; border:1px solid rgba(255,255,255,.25); height:42px; padding:0 12px; border-radius:12px; font-weight:800; cursor:pointer}
    .navBtn:hover{background:rgba(0,0,0,.6)}
    .navPrev{left:8px}
    .navNext{right:8px}

    .specs{display:grid; grid-template-columns:repeat(4,1fr); gap:8px}
    @media (max-width:900px){ .specs{grid-template-columns:repeat(2,1fr);} }
    .spec{background:rgba(255,255,255,.06); border:1px solid var(--line); border-radius:12px; padding:8px; font-size:13px}
    .h{font:700 14px/1 "Russo One"; margin-bottom:6px}
    .divider{height:1px; background:var(--line); margin:10px 0}
    .seller{display:flex; gap:10px; align-items:center}
    .avatar{width:44px; height:44px; border-radius:50%; background:#203157; display:flex; align-items:center; justify-content:center; font-weight:800}

    /* Pager at bottom */
    .pager{display:flex; justify-content:center; margin:16px 0 40px}

    /* Hide attribution link area completely */
    #dAttribution{display:none}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="logo">AUTO 369¬∞</div>
    <div class="pill yellow" id="tabSearch">–ü–æ—à—É–∫</div>
    <div class="pill" id="tabSell">–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</div>
    <div class="grow"></div>
    <!-- —ñ–º–ø–æ—Ä—Ç-–∫–Ω–æ–ø–∫–∏ –í–ò–î–ê–õ–ï–ù–û -->
  </header>

  <main class="container">
    <!-- –§–Ü–õ–¨–¢–†–ò -->
    <section class="panel" id="searchPanel">
      <div class="filters" id="filters">
        <div><label>–ú—ñ—Å—Ç–æ</label><select class="select" id="fltCity"></select></div>
        <div><label>–†–æ–∑–¥—ñ–ª</label><select class="select" id="fltSection"></select></div>
        <div><label>–ú–∞—Ä–∫–∞</label><select class="select" id="fltBrand"></select></div>
        <div><label>–ú–æ–¥–µ–ª—å</label><select class="select" id="fltModel"></select></div>
        <div><label>–†—ñ–∫ –≤—ñ–¥</label><select class="select" id="fltYearMin"></select></div>
        <div><label>–†—ñ–∫ –¥–æ</label><select class="select" id="fltYearMax"></select></div>
        <div><label>–¶—ñ–Ω–∞ –≤—ñ–¥, $</label><input class="input" id="fltPriceMin" placeholder="0"></div>
        <div><label>–¶—ñ–Ω–∞ –¥–æ, $</label><input class="input" id="fltPriceMax" placeholder="‚àû"></div>
        <div><label>–ü—Ä–æ–±—ñ–≥ –¥–æ, —Ç–∏—Å. –∫–º</label><input class="input" id="fltMileageMax" placeholder="‚àû"></div>
        <div><label>–ü–∞–ª–∏–≤–æ</label><select class="select" id="fltFuel"></select></div>
        <div><label>–ö–æ—Ä–æ–±–∫–∞</label><select class="select" id="fltGear"></select></div>
        <div><label>–ü—Ä–∏–≤—ñ–¥</label><select class="select" id="fltDrive"></select></div>
        <div><label>–ö—É–∑–æ–≤</label><select class="select" id="fltBody"></select></div>
        <div><label>–ö–æ–ª—ñ—Ä</label><select class="select" id="fltColor"></select></div>
        <div><label>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥, –∫.—Å.</label><input class="input" id="fltPowerMin" placeholder="0"></div>
        <div><label>–ü–æ—à—É–∫ (–Ω–∞–∑–≤–∞/VIN)</label><input class="input" id="fltQuery" placeholder="–Ω–∞–ø—Ä., Tesla, AA...VIN"></div>
        <div class="check"><input type="checkbox" id="fltRecent"> <label for="fltRecent">–ó–∞ 30 –¥–Ω—ñ–≤</label></div>
      </div>
      <div class="actions">
        <button class="btn" id="btnApply">–ó–Ω–∞–π—Ç–∏</button>
        <button class="btn ghost" id="btnReset">–°–∫–∏–Ω—É—Ç–∏</button>
        <select class="select" id="sortBy" style="max-width:240px">
          <option value="new">–°–æ—Ä—Ç—É–≤–∞—Ç–∏: –Ω–æ–≤—ñ</option>
          <option value="priceAsc">–¶—ñ–Ω–∞ ‚Üë</option>
          <option value="priceDesc">–¶—ñ–Ω–∞ ‚Üì</option>
          <option value="yearDesc">–†—ñ–∫ ‚Üì</option>
          <option value="mileageAsc">–ü—Ä–æ–±—ñ–≥ ‚Üë</option>
          <option value="powerDesc">–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å ‚Üì</option>
          <option value="viewsDesc">–ü–µ—Ä–µ–≥–ª—è–¥–∏ ‚Üì</option>
        </select>
      </div>
    </section>

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–ò -->
    <section class="topline">
      <div id="resCount" class="muted">0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</div>
      <div class="grow"></div>
    </section>
    <section class="grid" id="grid"></section>
    <div class="pager"><button class="btn" id="btnMore" style="display:none">–ü–æ–∫–∞–∑–∞—Ç–∏ —â–µ</button></div>

    <!-- –î–û–î–ê–¢–ò –û–ì–û–õ–û–®–ï–ù–ù–Ø (—è–∫ –ë–£–õ–û: —Å–µ–∫—Ü—ñ—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ) -->
    <section id="sellPanel" class="panel" style="display:none; margin-top:14px">
      <h3 style="margin:0 0 8px; font:700 18px/1 'Russo One'">–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h3>
      <div class="filters" style="grid-template-columns:repeat(3,1fr)">
        <div><label>–ú—ñ—Å—Ç–æ</label><select class="select" id="sCity"></select></div>
        <div><label>–†–æ–∑–¥—ñ–ª</label><select class="select" id="sSection"></select></div>
        <div><label>–ú–∞—Ä–∫–∞</label><select class="select" id="sBrand"></select></div>
        <div><label>–ú–æ–¥–µ–ª—å</label><select class="select" id="sModel"></select></div>
        <div><label>–†—ñ–∫</label><input class="input" id="sYear" placeholder="2018"></div>
        <div><label>–ü—Ä–æ–±—ñ–≥, –∫–º</label><input class="input" id="sMileage" placeholder="95000"></div>
        <div><label>–ü–∞–ª–∏–≤–æ</label><select class="select" id="sFuel"></select></div>
        <div><label>–ö–æ—Ä–æ–±–∫–∞</label><select class="select" id="sGear"></select></div>
        <div><label>–ü—Ä–∏–≤—ñ–¥</label><select class="select" id="sDrive"></select></div>
        <div><label>–ö—É–∑–æ–≤</label><select class="select" id="sBody"></select></div>
        <div><label>–ö–æ–ª—ñ—Ä</label><select class="select" id="sColor"></select></div>
        <div><label>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å, –∫.—Å.</label><input class="input" id="sPower" placeholder="120"></div>
        <div><label>–¶—ñ–Ω–∞, $</label><input class="input" id="sPrice" placeholder="13500"></div>
        <div><label>VIN (–æ–ø—Ü.)</label><input class="input" id="sVIN" placeholder="WAUZZZ..."></div>
        <div><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input class="input" id="sPhone" placeholder="+380..."></div>
        <div style="grid-column:1/-1"><label>–û–ø–∏—Å</label><textarea class="input" id="sDesc" rows="3" style="height:auto; padding:10px" placeholder="–°—Ç–∞–Ω, –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è... (–º—ñ–Ω. 20 —Å–∏–º–≤–æ–ª—ñ–≤)"></textarea></div>
      </div>
      <div class="actions">
        <button class="btn" id="sSave">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
        <div class="muted">–ê–Ω—Ç–∏—Å–ø–∞–º: 1 –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è / 60 —Å–µ–∫.</div>
      </div>
    </section>
  </main>

  <!-- DETAIL -->
  <div id="detail" class="detail">
    <div class="sheet">
      <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px">
        <div class="logo">AUTO 369¬∞</div>
        <div class="grow"></div>
        <button class="btn close" id="dClose" style="height:38px; line-height:38px; border-radius:12px; font:700 13px/38px 'Russo One'">–ó–∞–∫—Ä–∏—Ç–∏</button>
      </div>
      <div id="dHeader" style="display:flex; align-items:center; gap:10px; margin-bottom:8px"></div>
      <div id="dGal"></div>
      <div class="divider"></div>
      <div class="specs" id="dSpecs"></div>
      <div class="divider"></div>
      <div id="dDesc" class="muted"></div>
      <div class="divider"></div>
      <div class="seller" id="dSeller"></div>
      <div id="dAttribution" class="muted" style="margin-top:8px; font-size:12px; opacity:.8"></div>
    </div>
  </div>

  <script>
  const $ = s => document.querySelector(s), $$ = s => document.querySelectorAll(s);
  const DB_KEY = "auto369_listings_nice", CTRL_KEY = "auto369_ctrl_nice";
  const DRIVE=["FWD","RWD","AWD"], BODIES=["–°–µ–¥–∞–Ω","–•–µ—Ç—á–±–µ–∫","–ö—Ä–æ—Å–æ–≤–µ—Ä","–£–Ω—ñ–≤–µ—Ä—Å–∞–ª","–ú—ñ–Ω—ñ–≤–µ–Ω","–ö—É–ø–µ","–ü—ñ–∫–∞–ø","–ü–æ–∑–∞—à–ª—è—Ö–æ–≤–∏–∫"], COLORS=["–ß–æ—Ä–Ω–∏–π","–ë—ñ–ª–∏–π","–°—ñ—Ä–∏–π","–°–∏–Ω—ñ–π","–ß–µ—Ä–≤–æ–Ω–∏–π","–ó–µ–ª–µ–Ω–∏–π","–ö–æ—Ä–∏—á–Ω–µ–≤–∏–π","–°—Ä—ñ–±–ª—è—Å—Ç–∏–π"], FUELS=["–ë–µ–Ω–∑–∏–Ω","–î–∏–∑–µ–ª—å","–ì—ñ–±—Ä–∏–¥","–ï–ª–µ–∫—Ç—Ä–æ","–ì–ê–ó"], GEARS=["–ú–µ—Ö–∞–Ω—ñ–∫–∞","–ê–≤—Ç–æ–º–∞—Ç","–í–∞—Ä—ñ–∞—Ç–æ—Ä","–†–æ–±–æ—Ç"], SECTIONS=["–õ–µ–≥–∫–æ–≤—ñ","–ö—Ä–æ—Å–æ–≤–µ—Ä–∏","–ï–ª–µ–∫—Ç—Ä–æ","–í–∞–Ω–∏/–ú—ñ–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å–∏"], YEARS=Array.from({length:26},(_,i)=>2000+i), CITIES=["–ö–∏—ó–≤","–•–∞—Ä–∫—ñ–≤","–û–¥–µ—Å–∞","–î–Ω—ñ–ø—Ä–æ","–õ—å–≤—ñ–≤","–ó–∞–ø–æ—Ä—ñ–∂–∂—è","–ö—Ä–∏–≤–∏–π –†—ñ–≥","–ú–∏–∫–æ–ª–∞—ó–≤","–í—ñ–Ω–Ω–∏—Ü—è","–•–µ—Ä—Å–æ–Ω","–ü–æ–ª—Ç–∞–≤–∞","–ß–µ—Ä–Ω—ñ–≥—ñ–≤","–ß–µ—Ä–∫–∞—Å–∏","–°—É–º–∏","–ñ–∏—Ç–æ–º–∏—Ä","–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π","–ß–µ—Ä–Ω—ñ–≤—Ü—ñ","–†—ñ–≤–Ω–µ","–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫","–¢–µ—Ä–Ω–æ–ø—ñ–ª—å","–õ—É—Ü—å–∫","–£–∂–≥–æ—Ä–æ–¥","–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π","–ö–∞–º'—è–Ω—Å—å–∫–µ","–ö—Ä–µ–º–µ–Ω—á—É–∫","–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞","–ë—Ä–æ–≤–∞—Ä–∏","–ë–æ—Ä–∏—Å–ø—ñ–ª—å","–Ü—Ä–ø—ñ–Ω—å","–ë—É—á–∞"];  
  const BRANDS={"Toyota":["Corolla","Camry","RAV4","Land Cruiser","Yaris","Prius","Avensis"],"Volkswagen":["Golf","Passat","Tiguan","Polo","Touareg","Jetta","Transporter"],"BMW":["1 Series","3 Series","5 Series","X1","X3","X5"],"Mercedes-Benz":["A-Class","C-Class","E-Class","GLA","GLC","GLE","Vito"],"Audi":["A3","A4","A6","Q3","Q5","Q7"],"Skoda":["Fabia","Octavia","Superb","Kodiaq","Karoq"],"Renault":["Clio","Megane","Kadjar","Duster","Kangoo","Trafic"],"Hyundai":["i30","Elantra","Tucson","Santa Fe","Accent","Kona"],"Kia":["Rio","Ceed","Sportage","Sorento","Soul","Picanto"],"Nissan":["Micra","Juke","Qashqai","X-Trail","Leaf","Navara"],"Ford":["Fiesta","Focus","Mondeo","Kuga","EcoSport","Transit"],"Opel":["Corsa","Astra","Insignia","Mokka","–ó–∞—Ñ—ñ—Ä–∞","Vivaro"],"Mazda":["3","6","CX-5","CX-30","CX-9"],"Honda":["Civic","Accord","CR-V","HR-V","Jazz"],"Peugeot":["208","308","508","3008","5008","Partner"],"Citroen":["C3","C4","C5","C-Elysee","Berlingo","Jumpy"],"Volvo":["S60","S90","V60","XC60","XC90"],"Subaru":["Impreza","Forester","Outback","XV"],"Mitsubishi":["ASX","Outlander","Pajero"],"Tesla":["Model 3","Model S","Model Y","Model X"],"Chevrolet":["Aveo","Cruze","Captiva","Equinox"],"Jeep":["Renegade","Compass","Cherokee","Grand Cherokee"],"Fiat":["Panda","Punto","Tipo","Doblo","Talento"],"Porsche":["Macan","Cayenne","Panamera"],"Lexus":["IS","ES","RX","NX","UX"]};

  const getDB=()=>{try{return JSON.parse(localStorage.getItem(DB_KEY)||"[]")}catch{return[]}}; const setDB=v=>localStorage.setItem(DB_KEY,JSON.stringify(v)); const getCtrl=()=>{try{return JSON.parse(localStorage.getItem(CTRL_KEY)||"{}") }catch{return{}}}; const setCtrl=v=>localStorage.setItem(CTRL_KEY,JSON.stringify(v));
  const uid=()=>Math.random().toString(16).slice(2)+Date.now().toString(16); const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a; const pick=a=>a[rand(0,a.length-1)];

  // Fallback PNG
  function carPNG(title, seed=0, body="–°–µ–¥–∞–Ω", colorIdx=0){ const c=document.createElement('canvas'); c.width=800; c.height=500; const g=c.getContext('2d'); const palettes=[["#0e2a58","#163b7a","#0b1d3b"],["#3a1f5d","#532e8a","#1b0f2f"],["#0b3a2e","#147a60","#06241d"],["#6b1f1f","#a23333","#240909"]]; const pal=palettes[colorIdx%palettes.length]; const grad=g.createLinearGradient(0,0,800,500); grad.addColorStop(0,pal[0]); grad.addColorStop(1,pal[1]); g.fillStyle=grad; g.fillRect(0,0,800,500); g.fillStyle=pal[2]; g.fillRect(0,400,800,100); g.fillStyle="rgba(0,0,0,.25)"; g.beginPath(); g.ellipse(400,390,260,40,0,0,Math.PI*2); g.fill(); const carColors=['#ffcf33','#e74c3c','#2ecc71','#3498db','#9b59b6','#f39c12','#1abc9c','#ecf0f1']; const cc=carColors[(seed+3)%carColors.length]; function wheel(x,y){ g.fillStyle='#111'; g.beginPath(); g.arc(x,y,48,0,Math.PI*2); g.fill(); g.fillStyle='#bbb'; g.beginPath(); g.arc(x,y,20,0,Math.PI*2); g.fill(); } wheel(280,380); wheel(540,380); g.fillStyle=cc; g.strokeStyle='#00000040'; g.lineWidth=2; if(body==='–ö—Ä–æ—Å–æ–≤–µ—Ä'||body==='–ü–æ–∑–∞—à–ª—è—Ö–æ–≤–∏–∫'){ g.beginPath(); g.moveTo(180,360); g.lineTo(180,330); g.lineTo(260,300); g.lineTo(430,290); g.lineTo(520,310); g.lineTo(600,330); g.lineTo(620,360); g.closePath(); g.fill(); g.stroke(); } else if(body==='–•–µ—Ç—á–±–µ–∫'){ g.beginPath(); g.moveTo(160,360); g.lineTo(175,330); g.lineTo(260,300); g.lineTo(420,300); g.lineTo(520,330); g.lineTo(560,360); g.closePath(); g.fill(); g.stroke(); } else if(body==='–ö—É–ø–µ'){ g.beginPath(); g.moveTo(170,360); g.lineTo(210,320); g.quadraticCurveTo(360,270,520,310); g.lineTo(580,360); g.closePath(); g.fill(); g.stroke(); } else { g.beginPath(); g.moveTo(160,360); g.lineTo(210,320); g.quadraticCurveTo(360,270,520,310); g.lineTo(600,360); g.closePath(); g.fill(); g.stroke(); } g.fillStyle='rgba(255,255,255,.85)'; g.fillRect(300,305,90,35); g.fillRect(400,300,100,38); g.fillStyle='#fff8b0'; g.fillRect(600,340,14,10); g.fillStyle='#ff5c5c'; g.fillRect(160,340,12,10); g.fillStyle='#ffd33b'; g.font="bold 42px 'Russo One', Arial"; g.textAlign="center"; g.fillText(title, 400, 80); return c.toDataURL('image/png'); }
  function createImg(src, alt, fallback){ const img=document.createElement("img"); img.loading="lazy"; img.alt=alt; img.referrerPolicy="no-referrer"; img.src = src || fallback; img.onerror=()=>{ img.onerror=null; img.src=fallback; }; return img; }

  // Seed synthetic DB (2000+)
  function seedDB(){ const out=[]; const brands=Object.keys(BRANDS); let i=0; while(out.length<2000){ const city=CITIES[i%CITIES.length], section=SECTIONS[i%SECTIONS.length], brand=brands[i%brands.length], model=pick(BRANDS[brand]); const electric=section==="–ï–ª–µ–∫—Ç—Ä–æ"||brand==="Tesla"||model==="Leaf"||model==="Kona"; const year=electric?rand(2014,2025):rand(2005,2025); const mileage=electric?rand(0,180000):rand(10000,350000); const fuel=electric?"–ï–ª–µ–∫—Ç—Ä–æ":pick(FUELS.filter(f=>f!=="–ï–ª–µ–∫—Ç—Ä–æ")); const gear=pick(GEARS), power=electric?rand(120,450):rand(70,320); const price=Math.max(2000,Math.round((electric?18000:6000)+(2025-year)*500+rand(-1500,7000))); out.push({ id:uid(), city, section, brand, model, year, mileage, fuel, gear, drive:pick(DRIVE), body:pick(BODIES), power, color:pick(COLORS), price, currency:"$", created:Date.now()-rand(0,60*86400*1000), views:rand(100,500), vin:(Math.random()<.25?("UA"+rand(1000000,9999999)):""), seller:{name:pick(["–û–ª–µ–≥","–Ü—Ä–∏–Ω–∞","–°–µ—Ä–≥—ñ–π","–ê–Ω–Ω–∞","–í—ñ–∫—Ç–æ—Ä","–ú–∞–∫—Å–∏–º","–ú–∞—Ä—ñ—è"])+' '+pick(["–ö.","–õ.","–ú.","–°.","–î."]), phone:"+380"+rand(500000000,999999999)}, desc:"–ì–∞—Ä–Ω–∏–π —Å—Ç–∞–Ω, —á–µ—Å–Ω–∏–π –ø—Ä–æ–±—ñ–≥. –¢–û –≤—á–∞—Å–Ω–æ. –î–µ—Ç–∞–ª—ñ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.", images:[] }); i++; } const demo=["https://upload.wikimedia.org/wikipedia/commons/2/26/2018_Volkswagen_Golf_SE_NAV_TDi_1.6_Front.jpg","https://upload.wikimedia.org/wikipedia/commons/6/65/2018_Toyota_Camry_LE_front_6.22.18.jpg","https://upload.wikimedia.org/wikipedia/commons/b/b1/2018_BMW_320d_M_Sport_Automatic_2.0_Front.jpg","https://upload.wikimedia.org/wikipedia/commons/e/ea/2018_Audi_A4_Sport_TDi_2.0_Front.jpg","https://upload.wikimedia.org/wikipedia/commons/8/8e/2017_Skoda_Octavia_SE_TDi_1.6_Front.jpg","https://upload.wikimedia.org/wikipedia/commons/7/7f/2018_Kia_Sportage_3_CRDi_ISG_1.7_Front.jpg","https://upload.wikimedia.org/wikipedia/commons/1/16/2018_Mercedes-Benz_C200_2.0_Front.jpg","https://upload.wikimedia.org/wikipedia/commons/1/1e/2018_Volvo_XC60_Momentum_D4_AWD_2.0_Front.jpg","https://upload.wikimedia.org/wikipedia/commons/7/73/2017_Honda_Civic_SR_VTEC_1.0_Front.jpg","https://upload.wikimedia.org/wikipedia/commons/4/4a/2018_Mazda_6_Sport_Nav_2.2_Front.jpg"]; for(let k=0;k<out.length && k<demo.length*200;k++){ out[k].images=[demo[k%demo.length]]; } localStorage.setItem(DB_KEY, JSON.stringify(out)); }
  if(getDB().length===0) seedDB();

  // ==== –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–µ–ª–µ–∫—Ç—ñ–≤
  const fltCity=$("#fltCity"), fltSection=$("#fltSection"), fltBrand=$("#fltBrand"), fltModel=$("#fltModel"), fltYearMin=$("#fltYearMin"), fltYearMax=$("#fltYearMax"), fltFuel=$("#fltFuel"), fltGear=$("#fltGear"), fltDrive=$("#fltDrive"), fltBody=$("#fltBody"), fltColor=$("#fltColor"), fltPowerMin=$("#fltPowerMin"), fltQuery=$("#fltQuery"), fltRecent=$("#fltRecent");
  function fillSelect(el, arr, withAll=true, txt="–ë—É–¥—å-—è–∫–∏–π"){ el.innerHTML=(withAll?`<option value="">${txt}</option>`:'')+arr.map(x=>`<option value="${x}">${x}</option>`).join(''); }
  fillSelect(fltCity,CITIES); fillSelect(fltSection,SECTIONS); fillSelect(fltFuel,FUELS); fillSelect(fltGear,GEARS); fillSelect(fltDrive,DRIVE); fillSelect(fltBody,BODIES); fillSelect(fltColor,COLORS); fillSelect(fltBrand,Object.keys(BRANDS)); fltBrand.addEventListener('change',()=>fillSelect(fltModel,fltBrand.value?BRANDS[fltBrand.value]:[])); fillSelect(fltModel,[]); fillSelect(fltYearMin,YEARS); fillSelect(fltYearMax,YEARS);

  // –§–æ—Ä–º–∞ "–î–æ–¥–∞—Ç–∏"
  const mapSelectData={sCity:CITIES,sSection:SECTIONS,sFuel:FUELS,sGear:GEARS,sDrive:DRIVE,sBody:BODIES,sColor:COLORS,sBrand:Object.keys(BRANDS)}; Object.keys(mapSelectData).forEach(id=>fillSelect($("#"+id), mapSelectData[id], false)); fillSelect($("#sModel"), [], false); $("#sBrand").addEventListener("change", ()=> fillSelect($("#sModel"), BRANDS[$("#sBrand").value]||[], false));

  // ===== Custom select with portal overlay (does NOT close on scroll) =====
  let activeList=null, activeWrap=null;
  function closeAll(e){ if(activeList){ if(e && (activeList.contains(e.target) || activeWrap.contains(e.target))) return; activeList.style.display='none'; activeWrap.appendChild(activeList); activeList=null; activeWrap=null; } }
  document.addEventListener('click', closeAll);
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeAll(); });

  function enhanceSelect(sel){ if (matchMedia('(hover: none)').matches) return; const wrap=document.createElement('div'); wrap.className='nice'; const btn=document.createElement('button'); btn.type='button'; btn.className='nice-btn'; const list=document.createElement('div'); list.className='nice-list'; const opts=[...sel.options]; function refreshBtn(){ btn.textContent = opts[sel.selectedIndex]?.text || (sel.getAttribute('data-placeholder')||'–í–∏–±–µ—Ä—ñ—Ç—å'); } opts.forEach((o, idx)=>{ const it=document.createElement('div'); it.className='nice-item'+(o.selected?' active':''); it.textContent=o.text; it.onclick=(ev)=>{ ev.stopPropagation(); sel.selectedIndex=idx; refreshBtn(); [...list.children].forEach(c=>c.classList.remove('active')); it.classList.add('active'); closeAll(); sel.dispatchEvent(new Event('change')); }; list.appendChild(it); }); sel.classList.add('nice-hidden'); sel.parentNode.insertBefore(wrap, sel); wrap.appendChild(sel); wrap.appendChild(btn); refreshBtn(); function open(){ closeAll(); const r=btn.getBoundingClientRect(); list.style.left = r.left+'px'; list.style.top = (r.bottom+6)+'px'; list.style.width = r.width+'px'; list.style.display='block'; document.body.appendChild(list); activeList=list; activeWrap=wrap; }
    btn.onclick=(e)=>{ e.stopPropagation(); if(activeList===list){ closeAll(); } else { open(); } };
  }
  $$('.select').forEach(enhanceSelect);

  // ==== –ü–æ—à—É–∫/—Ä–µ–Ω–¥–µ—Ä
  const grid=$("#grid"), resCount=$("#resCount"), btnMore=$("#btnMore"), sortBy=$("#sortBy");
  let page=0, pageSize=24, lastResults=[];

  function applyFilters(){ const q=(fltQuery.value||"").trim().toLowerCase(); const pmin= +(($("#fltPriceMin").value||0)); const pmax= +(($("#fltPriceMax").value||0)); const mmax= +(($("#fltMileageMax").value||0)); const powMin = +( (fltPowerMin.value||0) ); let arr=getDB().filter(it=> (!fltCity.value || it.city===fltCity.value) && (!fltSection.value || it.section===fltSection.value) && (!fltBrand.value || it.brand===fltBrand.value) && (!fltModel.value || it.model===fltModel.value) && (!fltFuel.value || it.fuel===fltFuel.value) && (!fltGear.value || it.gear===fltGear.value) && (!fltDrive.value || it.drive===fltDrive.value) && (!fltBody.value || it.body===fltBody.value) && (!fltColor.value || it.color===fltColor.value) && (!fltYearMin.value || it.year>=+fltYearMin.value) && (!fltYearMax.value || it.year<=+fltYearMax.value) && (!pmin || it.price>=pmin) && (!pmax || it.price<=pmax) && (!mmax || (it.mileage/1000)<=mmax) && (!powMin || it.power>=powMin) && (!q || (it.brand+' '+it.model+' '+(it.vin||'') ).toLowerCase().includes(q)) && (!fltRecent.checked || (Date.now()-it.created)<=30*86400*1000) ); arr.sort((a,b)=>{ switch(sortBy.value){ case "priceAsc": return a.price-b.price; case "priceDesc": return b.price-a.price; case "yearDesc": return b.year-a.year; case "mileageAsc": return a.mileage-b.mileage; case "powerDesc": return b.power-a.power; case "viewsDesc": return b.views-a.views; default: return b.created-a.created; } }); lastResults=arr; page=0; grid.innerHTML=""; resCount.textContent=`${arr.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤`; renderMore(); }
  function remainingCount(){ return Math.max(0, lastResults.length - page*pageSize); }
  function updateMoreUI(){ btnMore.style.display = remainingCount()>0 ? "inline-flex" : "none"; }
  function renderMore(){ const slice=lastResults.slice(page*pageSize,(page+1)*pageSize); slice.forEach(renderCard); page++; updateMoreUI(); }
  function renderCard(it){ const el=document.createElement('article'); el.className="card"; el.setAttribute('role','button'); el.title="–î–∏–≤–∏—Ç–∏—Å—è"; const fallback=carPNG(`${it.brand} ${it.model}`, (it.year+it.price)%7, it.body, (it.power+it.year)%4); const firstImg=(Array.isArray(it.images)&&it.images.length)?it.images[0]:null; el.innerHTML=`<div class=\"thumb\"><div class=\"badge\">${it.price.toLocaleString('uk-UA')} ${it.currency||"$"}</div><div class=\"views\">üëÅ ${it.views||0}</div></div><div class=\"body\"><div class=\"title\">${it.brand} ${it.model} ‚Ä¢ ${it.year}</div><div class=\"meta\">${it.city} ‚Ä¢ ${it.section}</div><div class=\"meta\">${(it.mileage/1000|0)} —Ç–∏—Å.–∫–º ‚Ä¢ ${it.fuel} ‚Ä¢ ${it.gear}</div></div>`; el.querySelector(".thumb").prepend(createImg(firstImg, `${it.brand} ${it.model}`, fallback)); el.onclick=()=>openDetail(it.id); grid.appendChild(el); }
  let applyLock=false; $("#btnApply").onclick=()=>{ if(applyLock) return; applyLock=true; applyFilters(); setTimeout(()=>applyLock=false, 600); }; $("#btnReset").onclick=()=>{ $$("#searchPanel .select, #searchPanel .input").forEach(x=>x.value=""); fltRecent.checked=false; applyFilters(); }; btnMore.onclick=renderMore; sortBy.onchange=applyFilters; applyFilters();

  // ===== –î–µ—Ç–∞–ª—å–Ω–∞ + single-image slider =====
  function spec(k,v){return `<div class=\"spec\"><div class=\"h\">${k}</div>${v}</div>`}
  function setAttribution(url){ /* hidden */ }
  let galIndex=0, galImgs=[]; function renderGallery(title, body){ const gal=$("#dGal"); gal.innerHTML=`<div class=\"big\"><button class=\"navBtn navPrev\" id=\"galPrev\">‚Äπ</button><button class=\"navBtn navNext\" id=\"galNext\">‚Ä∫</button></div>`; const big=gal.querySelector('.big'); const url=galImgs[galIndex]; big.appendChild(createImg(url, 'photo', carPNG(title,galIndex,body,galIndex))); $("#galPrev").onclick=()=>{ galIndex=(galIndex-1+galImgs.length)%galImgs.length; renderGallery(title, body); }; $("#galNext").onclick=()=>{ galIndex=(galIndex+1)%galImgs.length; renderGallery(title, body); }; }
  document.addEventListener('keydown', (e)=>{ if($("#detail").classList.contains('active')){ if(e.key==='ArrowLeft') $("#galPrev")?.click(); if(e.key==='ArrowRight') $("#galNext")?.click(); if(e.key==='Escape') $("#dClose")?.click(); }});

  function openDetail(id){ const db=getDB(); const idx=db.findIndex(x=>x.id===id); if(idx<0) return; const it=db[idx]; it.views=(it.views||0)+1; db[idx]=it; setDB(db); const d=$("#detail"); d.classList.add('active'); $("#dClose").onclick=()=>{ d.classList.remove('active'); applyFilters(); }; $("#dHeader").innerHTML=`<div class=\"title\" style=\"font:700 20px/1.2 'Russo One'\">${it.brand} ${it.model} ${it.year}</div><div class=\"pill yellow\">${it.price.toLocaleString('uk-UA')} ${it.currency||"$"}</div><div class=\"pill\" style=\"margin-left:auto\">üëÅ ${it.views}</div>`; const imgs=(Array.isArray(it.images)&&it.images.length)?it.images:[]; galImgs = (imgs.length? imgs : [carPNG(`${it.brand} ${it.model}`,0,it.body,0), carPNG(`${it.brand} ${it.model}`,1,it.body,1), carPNG(`${it.brand} ${it.model}`,2,it.body,2)]); galIndex=0; renderGallery(`${it.brand} ${it.model}`, it.body); setAttribution(imgs[0]||""); $("#dSpecs").innerHTML= spec("–ú—ñ—Å—Ç–æ",it.city)+spec("–†–æ–∑–¥—ñ–ª",it.section)+spec("–ü—Ä–æ–±—ñ–≥",(it.mileage/1000|0)+" —Ç–∏—Å.–∫–º")+spec("–ü–∞–ª–∏–≤–æ",it.fuel)+spec("–ö–æ—Ä–æ–±–∫–∞",it.ge–∞—Ä||it.gear)+spec("–ü—Ä–∏–≤—ñ–¥",it.drive)+spec("–ö—É–∑–æ–≤",it.body)+spec("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å",it.power+" –∫.—Å.")+spec("–ö–æ–ª—ñ—Ä",it.color)+spec("VIN",it.vin||"‚Äî"); $("#dDesc").textContent = it.desc||""; $("#dSeller").innerHTML=`<div class=\"avatar\">${(it.seller?.name||"–ü")[0]}</div><div><div class=\"h\">–ü—Ä–æ–¥–∞–≤–µ—Ü—å</div><div>${it.seller?.name||"–ü—Ä–æ–¥–∞–≤–µ—Ü—å"}</div><div class=\"small\">${it.seller?.phone||""}</div></div>`; }

  // –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è (—è–∫ –±—É–ª–æ: –±–µ–∑ –º–æ–¥–∞–ª–∫–∏, –ø—Ä–æ—Å—Ç–æ —Å–µ–∫—Ü—ñ—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ)
  $("#sSave").onclick=()=>{ const ctrl=getCtrl(); const now=Date.now(); if(ctrl.lastPost && now-ctrl.lastPost<60000){ alert("–ü—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –º–æ–∂–Ω–∞ –Ω–µ —á–∞—Å—Ç—ñ—à–µ 1 —Ä–∞–∑—É –Ω–∞ 60 —Å–µ–∫."); return; } const city=$("#sCity").value, section=$("#sSection").value, brand=$("#sBrand").value, model=$("#sModel").value; if(!city||!section||!brand||!model) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –º—ñ—Å—Ç–æ/—Ä–æ–∑–¥—ñ–ª/–º–∞—Ä–∫—É/–º–æ–¥–µ–ª—å."); const year=+(($("#sYear").value||0)); if(!(year>=1990 && year<=2025)) return alert("–†—ñ–∫ 1990‚Äì2025."); const price=+(($("#sPrice").value||0)); if(!(price>=500 && price<=500000)) return alert("–¶—ñ–Ω–∞ $500‚Äì500000."); const phone=$("#sPhone").value.trim(); if(!/^\+?\d[\d\s\-]{8,}$/.test(phone)) return alert("–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π."); const vin=$("#sVIN").value.trim(); if(vin && !/^[A-HJ-NPR-Z0-9]{8,17}$/i.test(vin)) return alert("VIN 8‚Äì17 —Å–∏–º–≤–æ–ª—ñ–≤."); const desc=$("#sDesc").value.trim(); if(desc.length<20) return alert("–û–ø–∏—Å ‚â• 20 —Å–∏–º–≤–æ–ª—ñ–≤."); const mileage=+(($("#sMileage").value||0)), fuel=$("#sFuel").value, gear=$("#sGear").value, drive=$("#sDrive").value, body=$("#sBody").value, color=$("#sColor").value, power=+(($("#sPower").value||100)); const db=getDB(); if(vin && db.some(x=>x.vin && x.vin===vin)) return alert("–ê–≤—Ç–æ –∑ —Ç–∞–∫–∏–º VIN –≤–∂–µ —ñ—Å–Ω—É—î."); db.unshift({ id:uid(), city, section, brand, model, year, mileage, fuel, gear, drive, body, power, color, price, currency:"$", created: now, vin, seller:{name:"–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –ø—Ä–æ–¥–∞–≤–µ—Ü—å", phone}, desc, views: rand(5,25), images:[] }); setDB(db); ctrl.lastPost=now; setCtrl(ctrl); alert("–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ."); applyFilters(); };

  // –í–∫–ª–∞–¥–∫–∏ (—è–∫ –±—É–ª–æ)
  $("#tabSearch").onclick=()=>{ $("#sellPanel").style.display="none"; window.scrollTo({top:0, behavior:"smooth"}); };
  $("#tabSell").onclick=()=>{ $("#sellPanel").style.display="block"; $("#sellPanel").scrollIntoView({behavior:'smooth', block:'start'}); };

  </script>
</body>
</html>
