<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>AUTO 369¬∞ ‚Äî –ø–æ—à—É–∫ —ñ –ø—Ä–æ–¥–∞–∂ –∞–≤—Ç–æ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no"/>
  <meta name="format-detection" content="telephone=no"/>
  <meta name="theme-color" content="#07142e"/>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: radial-gradient(1100px 800px at 50% 10%, #0a1f44 0%, #081939 42%, #07142e 100%);
      --paper:#fff; --ink:#000;
      --brand:#ffd33b; --brand-press:#ffbf00;
      --line:rgba(255,255,255,.14); --glass:rgba(12,20,44,.68);
      --field-bg:rgba(255,255,255,.08); --field-br:rgba(255,255,255,.22); --ph:rgba(255,255,255,.75);
      --menu-bg:#0b1635; --menu-br:rgba(255,255,255,.22); --menu-hover:rgba(255,255,255,.10);
      --top:60px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--paper); font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:100; height:var(--top);
      display:flex; align-items:center; gap:10px; padding:10px 12px;
      background:linear-gradient(180deg, rgba(7,15,35,.95), rgba(7,15,35,.72));
      border-bottom:1px solid var(--line);
    }
    .logo{background:var(--brand); color:#111; border-radius:12px; padding:8px 12px; font:700 16px/1 "Russo One",sans-serif;}
    .pill{display:inline-flex; align-items:center; gap:8px; height:38px; padding:0 12px; border-radius:12px; border:1px solid var(--line); background:rgba(255,255,255,.08); cursor:pointer; font-weight:700;}
    .pill.yellow{background:var(--brand); color:#111; border-color:rgba(0,0,0,.2); font-family:"Russo One"; text-transform:uppercase;}
    .grow{flex:1}

    .container{max-width:1200px; margin:12px auto; padding:0 12px;}
    .panel{background:var(--glass); border:1px solid var(--line); border-radius:16px; padding:12px; box-shadow:0 20px 40px rgba(0,0,0,.45); backdrop-filter:saturate(130%) blur(8px);}

    /* Inputs */
    .filters{display:grid; grid-template-columns:repeat(6,1fr); gap:10px;}
    @media (max-width:1024px){ .filters{grid-template-columns:repeat(3,1fr);} }
    @media (max-width:640px){ .filters{grid-template-columns:1fr 1fr;} }
    label{font-size:12px; font-weight:800; opacity:.92; display:block; margin:0 0 6px;}
    .input,.select{
      width:100%; height:46px; border-radius:12px; border:1px solid var(--field-br);
      background:var(--field-bg); color:#fff; padding:0 12px; font-size:14px; outline:none;
    }
    .input::placeholder{color:var(--ph)}
    .actions{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}
    .btn{height:48px; border:none; border-radius:14px; background:var(--brand); color:#111; font:700 16px/48px "Russo One"; padding:0 18px; cursor:pointer; box-shadow:0 6px 0 rgba(0,0,0,.35), inset 0 -3px 0 rgba(0,0,0,.18);}
    .btn:active{transform:translateY(2px); background:var(--brand-press); box-shadow:0 4px 0 rgba(0,0,0,.35), inset 0 -2px 0 rgba(0,0,0,.18);}
    .btn.ghost{background:rgba(255,255,255,.1); color:#fff;}
    .check{display:flex; align-items:center; gap:8px; margin-top:12px; font-size:13px; opacity:.9}

    /* Nice Select (desktop) */
    @media (hover:hover){
      .select.nice-hidden{position:absolute; inset:0; opacity:0; pointer-events:none}
      .nice{position:relative}
      .nice-btn{
        width:100%; height:46px; border-radius:12px; border:1px solid var(--field-br);
        background:var(--field-bg); color:#fff; padding:0 38px 0 12px; text-align:left; font-size:14px; font-weight:600; cursor:pointer;
      }
      .nice-btn:after{content:"‚ñæ"; position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.8; pointer-events:none}
      .nice-list{
        position:absolute; left:0; right:0; top:calc(100% + 6px);
        background:var(--menu-bg); border:1px solid var(--menu-br); border-radius:12px; padding:6px;
        box-shadow:0 18px 38px rgba(0,0,0,.6); display:none; max-height:260px; overflow:auto; z-index:200;
      }
      .nice.open .nice-list{display:block}
      .nice-item{padding:10px 12px; border-radius:10px; cursor:pointer; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
      .nice-item:hover{background:var(--menu-hover)}
      .nice-item.active{background:rgba(255,255,255,.12)}
    }

    .topline{display:flex; align-items:center; gap:10px; margin:14px 0;}
    .grid{display:grid; grid-template-columns:repeat(3,1fr); gap:12px;}
    @media (max-width:1024px){ .grid{grid-template-columns:repeat(2,1fr);} }
    @media (max-width:640px){ .grid{grid-template-columns:1fr;} }

    .card{
      background:rgba(255,255,255,.06); border:1px solid var(--line); border-radius:14px; overflow:hidden;
      display:flex; flex-direction:column; cursor:pointer; transition:transform .08s ease, box-shadow .08s ease;
    }
    .card:active{transform:translateY(1px); box-shadow:0 10px 22px rgba(0,0,0,.35)}
    .thumb{position:relative; padding-top:62%; background:#0b3a8a; overflow:hidden;}
    .thumb img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover;}
    .badge{position:absolute; left:8px; bottom:8px; background:var(--brand); color:#111; border-radius:10px; padding:6px 10px; font:700 14px/1 "Russo One";}
    .views{position:absolute; right:8px; bottom:8px; background:rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.25); color:#fff; border-radius:10px; padding:5px 8px; font-weight:700; font-size:12px}
    .body{padding:10px; display:flex; flex-direction:column; gap:6px}
    .title{font:700 16px/1.2 "Russo One"; letter-spacing:.4px}
    .meta{font-size:13px; opacity:.95}

    .detail{position:fixed; inset:0; z-index:120; display:none; background:rgba(0,0,0,.5);}
    .detail.active{display:block;}
    .sheet{position:absolute; left:50%; top:6vh; transform:translateX(-50%); width:min(1080px,96vw); max-height:88vh; overflow:auto; background:var(--glass); border:1px solid var(--line); border-radius:16px; padding:12px; box-shadow:0 20px 40px rgba(0,0,0,.6); backdrop-filter:saturate(130%) blur(8px);}
    .gal{display:grid; grid-template-columns:2fr 1fr; gap:10px;}
    @media (max-width:900px){ .gal{grid-template-columns:1fr;} }
    .gal .big{position:relative; padding-top:56%; background:#0b3a8a; border-radius:12px; overflow:hidden}
    .gal .big img,.gal .sm img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
    .gal .sm{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .close{position:sticky; top:0; margin-left:auto}
    .specs{display:grid; grid-template-columns:repeat(4,1fr); gap:8px}
    @media (max-width:900px){ .specs{grid-template-columns:repeat(2,1fr);} }
    .spec{background:rgba(255,255,255,.06); border:1px solid var(--line); border-radius:12px; padding:8px; font-size:13px}
    .h{font:700 14px/1 "Russo One"; margin-bottom:6px}
    .divider{height:1px; background:var(--line); margin:10px 0}
    .seller{display:flex; gap:10px; align-items:center}
    .avatar{width:44px; height:44px; border-radius:50%; background:#203157; display:flex; align-items:center; justify-content:center; font-weight:800}

    /* Modal add */
    .modal{position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:140}
    .modal.active{display:flex}
    .modal .window{width:min(1080px,96vw); max-height:90vh; overflow:auto; background:var(--glass); border:1px solid var(--line); border-radius:16px; padding:12px; box-shadow:0 20px 40px rgba(0,0,0,.65); backdrop-filter:saturate(130%) blur(8px);}
    .modal .titlebar{display:flex; align-items:center; gap:8px; margin-bottom:8px}
    .modal .x{margin-left:auto}
    .pager{display:flex; align-items:center; justify-content:center; gap:8px; margin:16px 0 40px}
    .pager .pg-btn{min-width:44px; height:44px; border-radius:12px; border:1px solid var(--line); background:rgba(255,255,255,.08); color:#fff; font-weight:800; cursor:pointer}
    .pager .pg-btn[disabled]{opacity:.45; cursor:default}
    .pager .pg-info{opacity:.9; font-weight:700}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="logo">AUTO 369¬∞</div>
    <div class="pill yellow" id="tabSearch">–ü–æ—à—É–∫</div>
    <div class="pill" id="btnOpenAdd">–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</div>
    <div class="grow"></div>
    <label class="pill" style="cursor:pointer">
      <input type="file" id="importJson" accept="application/json" style="display:none">
      –Ü–º–ø–æ—Ä—Ç JSON
    </label>
    <button class="pill" id="btnClear">–û—á–∏—Å—Ç–∏—Ç–∏ –±–∞–∑—É</button>
  </header>

  <main class="container">
    <!-- –§–Ü–õ–¨–¢–†–ò -->
    <section class="panel" id="searchPanel">
      <div class="filters" id="filters">
        <div><label>–û–±–ª–∞—Å—Ç—å</label><select class="select" id="fltRegion"></select></div>
        <div><label>–ú—ñ—Å—Ç–æ</label><select class="select" id="fltCity"></select></div>
        <div><label>–ü–æ—à—É–∫ –º—ñ—Å—Ç–∞</label>
          <input class="input" id="fltCityText" list="cityDL" placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏...">
          <datalist id="cityDL"></datalist>
        </div>

        <div><label>–ú–∞—Ä–∫–∞</label><select class="select" id="fltBrand"></select></div>
        <div><label>–ú–æ–¥–µ–ª—å</label><select class="select" id="fltModel"></select></div>

        <div><label>–†—ñ–∫ –≤—ñ–¥</label><select class="select" id="fltYearMin"></select></div>
        <div><label>–†—ñ–∫ –¥–æ</label><select class="select" id="fltYearMax"></select></div>

        <div><label>–¶—ñ–Ω–∞ –≤—ñ–¥, $</label><input class="input" id="fltPriceMin" placeholder="0"></div>
        <div><label>–¶—ñ–Ω–∞ –¥–æ, $</label><input class="input" id="fltPriceMax" placeholder="‚àû"></div>
        <div><label>–ü—Ä–æ–±—ñ–≥ –¥–æ, —Ç–∏—Å. –∫–º</label><input class="input" id="fltMileageMax" placeholder="‚àû"></div>
        <div><label>–ü–∞–ª–∏–≤–æ</label><select class="select" id="fltFuel"></select></div>
        <div><label>–ö–æ—Ä–æ–±–∫–∞</label><select class="select" id="fltGear"></select></div>
        <div><label>–ü—Ä–∏–≤—ñ–¥</label><select class="select" id="fltDrive"></select></div>

        <div><label>–ö—É–∑–æ–≤</label><select class="select" id="fltBody"></select></div>
        <div><label>–ö–æ–ª—ñ—Ä</label><select class="select" id="fltColor"></select></div>
        <div><label>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥, –∫.—Å.</label><input class="input" id="fltPowerMin" placeholder="0"></div>
        <div><label>–ü–æ—à—É–∫ (–Ω–∞–∑–≤–∞/VIN)</label><input class="input" id="fltQuery" placeholder="–Ω–∞–ø—Ä., Tesla, AA...VIN"></div>
        <div class="check"><input type="checkbox" id="fltRecent"> <label for="fltRecent">–ó–∞ 30 –¥–Ω—ñ–≤</label></div>
      </div>
      <div class="actions">
        <button class="btn" id="btnApply">–ó–Ω–∞–π—Ç–∏</button>
        <button class="btn ghost" id="btnReset">–°–∫–∏–Ω—É—Ç–∏</button>
        <select class="select" id="sortBy" style="max-width:240px">
          <option value="new">–°–æ—Ä—Ç—É–≤–∞—Ç–∏: –Ω–æ–≤—ñ</option>
          <option value="priceAsc">–¶—ñ–Ω–∞ ‚Üë</option>
          <option value="priceDesc">–¶—ñ–Ω–∞ ‚Üì</option>
          <option value="yearDesc">–†—ñ–∫ ‚Üì</option>
          <option value="mileageAsc">–ü—Ä–æ–±—ñ–≥ ‚Üë</option>
          <option value="powerDesc">–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å ‚Üì</option>
          <option value="viewsDesc">–ü–µ—Ä–µ–≥–ª—è–¥–∏ ‚Üì</option>
        </select>
      </div>
    </section>

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–ò -->
    <section class="topline">
      <div id="resCount" class="muted">0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</div>
      <div class="grow"></div>
    </section>
    <section class="grid" id="grid"></section>
    <div class="pager" id="pager" aria-label="–ü–∞–≥—ñ–Ω–∞—Ü—ñ—è">
      <button class="pg-btn" id="pgPrev">‚Üê</button>
      <div class="pg-info" id="pgInfo">–°—Ç–æ—Ä—ñ–Ω–∫–∞ 1/1</div>
      <button class="pg-btn" id="pgNext">‚Üí</button>
    </div>
  </main>

  <!-- DETAIL -->
  <div id="detail" class="detail">
    <div class="sheet">
      <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px">
        <div class="logo">AUTO 369¬∞</div>
        <div class="grow"></div>
        <button class="btn close" id="dClose" style="height:38px; line-height:38px; border-radius:12px; font:700 13px/38px 'Russo One'">–ó–∞–∫—Ä–∏—Ç–∏</button>
      </div>
      <div id="dHeader" style="display:flex; align-items:center; gap:10px; margin-bottom:8px"></div>
      <div class="gal" id="dGal"></div>
      <div class="divider"></div>
      <div class="specs" id="dSpecs"></div>
      <div class="divider"></div>
      <div id="dDesc" class="muted"></div>
      <div class="divider"></div>
      <div class="seller" id="dSeller"></div>
    </div>
  </div>

  <!-- ADD MODAL -->
  <div class="modal" id="addModal" role="dialog" aria-modal="true" aria-label="–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è">
    <div class="window">
      <div class="titlebar">
        <div class="logo">AUTO 369¬∞</div>
        <div style="font:700 16px/1 'Russo One'">–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</div>
        <button class="btn ghost x" id="btnCloseAdd" style="height:38px; line-height:38px">–ó–∞–∫—Ä–∏—Ç–∏</button>
      </div>
      <section id="sellPanel" class="panel" style="background:transparent; border:none; box-shadow:none; backdrop-filter:none; padding:0">
        <div class="filters" style="grid-template-columns:repeat(3,1fr)">
          <div><label>–ú—ñ—Å—Ç–æ</label><select class="select" id="sCity"></select></div>
          <div><label>–†–æ–∑–¥—ñ–ª</label><select class="select" id="sSection"></select></div>

          <div><label>–ú–∞—Ä–∫–∞</label><select class="select" id="sBrand"></select></div>
          <div><label>–ú–æ–¥–µ–ª—å</label><select class="select" id="sModel"></select></div>
          <div id="brandOtherWrap" style="display:none"><label>–Ü–Ω—à–∞ –º–∞—Ä–∫–∞</label><input class="input" id="sBrandOther" placeholder="–í–≤–µ–¥—ñ—Ç—å –º–∞—Ä–∫—É"></div>

          <div><label>–†—ñ–∫</label><input class="input" id="sYear" placeholder="2018"></div>
          <div><label>–ü—Ä–æ–±—ñ–≥, –∫–º</label><input class="input" id="sMileage" placeholder="95000"></div>
          <div><label>–ü–∞–ª–∏–≤–æ</label><select class="select" id="sFuel"></select></div>
          <div><label>–ö–æ—Ä–æ–±–∫–∞</label><select class="select" id="sGear"></select></div>
          <div><label>–ü—Ä–∏–≤—ñ–¥</label><select class="select" id="sDrive"></select></div>
          <div><label>–ö—É–∑–æ–≤</label><select class="select" id="sBody"></select></div>
          <div><label>–ö–æ–ª—ñ—Ä</label><select class="select" id="sColor"></select></div>
          <div><label>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å, –∫.—Å.</label><input class="input" id="sPower" placeholder="120"></div>
          <div><label>–¶—ñ–Ω–∞, $</label><input class="input" id="sPrice" placeholder="13500"></div>
          <div><label>VIN (–æ–ø—Ü.)</label><input class="input" id="sVIN" placeholder="WAUZZZ..."></div>
          <div><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input class="input" id="sPhone" placeholder="+380..."></div>
          <div style="grid-column:1/-1"><label>–û–ø–∏—Å</label><textarea class="input" id="sDesc" rows="3" style="height:auto; padding:10px" placeholder="–°—Ç–∞–Ω, –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è... (–º—ñ–Ω. 20 —Å–∏–º–≤–æ–ª—ñ–≤)"></textarea></div>
          <div style="grid-column:1/-1"><label>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è (URL –∞–±–æ data: —á–µ—Ä–µ–∑ –∫–æ–º—É)</label><input class="input" id="sImages" placeholder="https://...jpg, https://...jpg"></div>
        </div>
        <div class="actions">
          <button class="btn" id="sSave">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
          <div class="muted">–ê–Ω—Ç–∏—Å–ø–∞–º: 1 –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è / 60 —Å–µ–∫.</div>
        </div>
      </section>
    </div>
  </div>

  <script>
  // ====== –õ–µ–≥–∫–∞, –±–µ–∑–ø–µ—á–Ω–∞ —Ä–æ–±–æ—Ç–∞ –∑—ñ —Å—Ö–æ–≤–∏—â–µ–º (localStorage ‚Üí sessionStorage) ======
  const SAFE = {
    get(k){ try{ return localStorage.getItem(k) ?? sessionStorage.getItem(k); }catch{ try{ return sessionStorage.getItem(k); }catch{ return null } },
    set(k,v){
      try{ localStorage.setItem(k,v); return 'local'; }
      catch(e){
        try{ sessionStorage.setItem(k,v); alert("–ú—ñ—Å—Ü—è –≤ –ø–∞–º º—è—Ç—ñ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–µ –≤–∏—Å—Ç–∞—á–∞—î ‚Äî –¥–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ç–∏–º—á–∞—Å–æ–≤–æ (–¥–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)."); return 'session'; }
        catch{ console.warn("Storage failed"); return 'none'; }
      }
    },
    del(k){ try{ localStorage.removeItem(k) }catch{} try{ sessionStorage.removeItem(k) }catch{} }
  };

  const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
  const EXTRA_KEY="auto369_extras";   // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ ¬´–¥–æ–¥–∞–Ω—ñ/—ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ¬ª
  const CTRL_KEY ="auto369_ctrl";     // –¥—Ä—ñ–±–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è/—Ç–∞–π–º–µ—Ä–∏ –∞–Ω—Ç–∏—Å–ø–∞–º—É

  // ==== –¥–æ–≤—ñ–¥–Ω–∏–∫–∏ ====
  const DRIVE=["FWD","RWD","AWD"];
  const BODIES=["–°–µ–¥–∞–Ω","–•–µ—Ç—á–±–µ–∫","–ö—Ä–æ—Å–æ–≤–µ—Ä","–£–Ω—ñ–≤–µ—Ä—Å–∞–ª","–ú—ñ–Ω—ñ–≤–µ–Ω","–ö—É–ø–µ","–ü—ñ–∫–∞–ø","–ü–æ–∑–∞—à–ª—è—Ö–æ–≤–∏–∫","–ö–∞–±—Ä—ñ–æ–ª–µ—Ç","–õ—ñ—Ñ—Ç–±–µ–∫","–§—É—Ä–≥–æ–Ω"];
  const COLORS=["–ß–æ—Ä–Ω–∏–π","–ë—ñ–ª–∏–π","–°—ñ—Ä–∏–π","–°–∏–Ω—ñ–π","–ß–µ—Ä–≤–æ–Ω–∏–π","–ó–µ–ª–µ–Ω–∏–π","–ö–æ—Ä–∏—á–Ω–µ–≤–∏–π","–°—Ä—ñ–±–ª—è—Å—Ç–∏–π","–ñ–æ–≤—Ç–∏–π","–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π","–ë–µ–∂–µ–≤–∏–π"];
  const FUELS=["–ë–µ–Ω–∑–∏–Ω","–î–∏–∑–µ–ª—å","–ì—ñ–±—Ä–∏–¥","–ï–ª–µ–∫—Ç—Ä–æ","–ì–ê–ó"];
  const GEARS=["–ú–µ—Ö–∞–Ω—ñ–∫–∞","–ê–≤—Ç–æ–º–∞—Ç","–í–∞—Ä—ñ–∞—Ç–æ—Ä","–†–æ–±–æ—Ç"];
  const SECTIONS=["–õ–µ–≥–∫–æ–≤—ñ","–ö—Ä–æ—Å–æ–≤–µ—Ä–∏","–ï–ª–µ–∫—Ç—Ä–æ","–í–∞–Ω–∏/–ú—ñ–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å–∏","–ü—ñ–∫–∞–ø–∏","–ü–æ–∑–∞—à–ª—è—Ö–æ–≤–∏–∫–∏"];
  const YEARS=Array.from({length:31},(_,i)=>1995+i);

  const REGIONS={
    "–ê–≤—Ç–æ–Ω–æ–º–Ω–∞ –†–µ—Å–ø—É–±–ª—ñ–∫–∞ –ö—Ä–∏–º":["–°—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å","–Ø–ª—Ç–∞","–ö–µ—Ä—á","–Ñ–≤–ø–∞—Ç–æ—Ä—ñ—è"],
    "–í—ñ–Ω–Ω–∏—Ü—å–∫–∞":["–í—ñ–Ω–Ω–∏—Ü—è","–ñ–º–µ—Ä–∏–Ω–∫–∞","–•–º—ñ–ª—å–Ω–∏–∫","–ö–æ–∑—è—Ç–∏–Ω","–ú–æ–≥–∏–ª—ñ–≤-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π"],
    "–í–æ–ª–∏–Ω—Å—å–∫–∞":["–õ—É—Ü—å–∫","–ö–æ–≤–µ–ª—å","–ù–æ–≤–æ–≤–æ–ª–∏–Ω—Å—å–∫"],
    "–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞":["–î–Ω—ñ–ø—Ä–æ","–ö—Ä–∏–≤–∏–π –†—ñ–≥","–ö–∞–º'—è–Ω—Å—å–∫–µ","–ù—ñ–∫–æ–ø–æ–ª—å","–ü–∞–≤–ª–æ–≥—Ä–∞–¥"],
    "–î–æ–Ω–µ—Ü—å–∫–∞":["–î–æ–Ω–µ—Ü—å–∫","–ú–∞—Ä—ñ—É–ø–æ–ª—å","–ö—Ä–∞–º–∞—Ç–æ—Ä—Å—å–∫","–°–ª–æ–≤'—è–Ω—Å—å–∫","–ë–∞—Ö–º—É—Ç"],
    "–ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞":["–ñ–∏—Ç–æ–º–∏—Ä","–ë–µ—Ä–¥–∏—á—ñ–≤","–ù–æ–≤–æ–≥—Ä–∞–¥-–í–æ–ª–∏–Ω—Å—å–∫–∏–π"],
    "–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞":["–£–∂–≥–æ—Ä–æ–¥","–ú—É–∫–∞—á–µ–≤–æ","–•—É—Å—Ç","–ë–µ—Ä–µ–≥–æ–≤–µ"],
    "–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞":["–ó–∞–ø–æ—Ä—ñ–∂–∂—è","–ú–µ–ª—ñ—Ç–æ–ø–æ–ª—å","–ë–µ—Ä–¥—è–Ω—Å—å–∫","–ï–Ω–µ—Ä–≥–æ–¥–∞—Ä"],
    "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞":["–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫","–ö–∞–ª—É—à","–ö–æ–ª–æ–º–∏—è"],
    "–ö–∏—ó–≤—Å—å–∫–∞":["–ö–∏—ó–≤","–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞","–ë—Ä–æ–≤–∞—Ä–∏","–ë–æ—Ä–∏—Å–ø—ñ–ª—å","–Ü—Ä–ø—ñ–Ω—å","–ë—É—á–∞","–§–∞—Å—Ç—ñ–≤","–í–∏—à–≥–æ—Ä–æ–¥"],
    "–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞":["–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π","–û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ—è","–°–≤—ñ—Ç–ª–æ–≤–æ–¥—Å—å–∫"],
    "–õ—É–≥–∞–Ω—Å—å–∫–∞":["–õ—É–≥–∞–Ω—Å—å–∫","–°—î–≤—î—Ä–æ–¥–æ–Ω–µ—Ü—å–∫","–õ–∏—Å–∏—á–∞–Ω—Å—å–∫","–†—É–±—ñ–∂–Ω–µ"],
    "–õ—å–≤—ñ–≤—Å—å–∫–∞":["–õ—å–≤—ñ–≤","–î—Ä–æ–≥–æ–±–∏—á","–°—Ç—Ä–∏–π","–ß–µ—Ä–≤–æ–Ω–æ–≥—Ä–∞–¥","–°–∞–º–±—ñ—Ä","–¢—Ä—É—Å–∫–∞–≤–µ—Ü—å"],
    "–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞":["–ú–∏–∫–æ–ª–∞—ó–≤","–ü–µ—Ä–≤–æ–º–∞–π—Å—å–∫","–í–æ–∑–Ω–µ—Å–µ–Ω—Å—å–∫","–û—á–∞–∫—ñ–≤"],
    "–û–¥–µ—Å—å–∫–∞":["–û–¥–µ—Å–∞","–ß–æ—Ä–Ω–æ–º–æ—Ä—Å—å–∫","–Æ–∂–Ω–µ","–Ü–∑–º–∞—ó–ª","–ë—ñ–ª—è—ó–≤–∫–∞"],
    "–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞":["–ü–æ–ª—Ç–∞–≤–∞","–ö—Ä–µ–º–µ–Ω—á—É–∫","–õ—É–±–Ω–∏","–ú–∏—Ä–≥–æ—Ä–æ–¥"],
    "–†—ñ–≤–Ω–µ–Ω—Å—å–∫–∞":["–†—ñ–≤–Ω–µ","–î—É–±–Ω–æ","–ö—É–∑–Ω–µ—Ü–æ–≤—Å—å–∫"],
    "–°—É–º—Å—å–∫–∞":["–°—É–º–∏","–ö–æ–Ω–æ—Ç–æ–ø","–®–æ—Å—Ç–∫–∞","–û—Ö—Ç–∏—Ä–∫–∞"],
    "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞":["–¢–µ—Ä–Ω–æ–ø—ñ–ª—å","–ß–æ—Ä—Ç–∫—ñ–≤","–ö—Ä–µ–º–µ–Ω–µ—Ü—å"],
    "–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞":["–•–∞—Ä–∫—ñ–≤","–õ–æ–∑–æ–≤–∞","–Ü–∑—é–º","–ß—É–≥—É—ó–≤"],
    "–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞":["–•–µ—Ä—Å–æ–Ω","–ù–æ–≤–∞ –ö–∞—Ö–æ–≤–∫–∞","–ö–∞—Ö–æ–≤–∫–∞"],
    "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞":["–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π","–ö–∞–º'—è–Ω–µ—Ü—å-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π","–®–µ–ø–µ—Ç—ñ–≤–∫–∞"],
    "–ß–µ—Ä–∫–∞—Å—å–∫–∞":["–ß–µ—Ä–∫–∞—Å–∏","–£–º–∞–Ω—å","–°–º—ñ–ª–∞"],
    "–ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∞":["–ß–µ—Ä–Ω—ñ–≤—Ü—ñ","–ù–æ–≤–æ–¥–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫"],
    "–ß–µ—Ä–Ω—ñ–≥—ñ–≤—Å—å–∫–∞":["–ß–µ—Ä–Ω—ñ–≥—ñ–≤","–ù—ñ–∂–∏–Ω","–ü—Ä–∏–ª—É–∫–∏"],
    "–º. –ö–∏—ó–≤":["–ö–∏—ó–≤"],
    "–º. –°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å":["–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å"]
  };

  // –í–µ–ª–∏–∫–∏–π —Å–ø–∏—Å–æ–∫ –±—Ä–µ–Ω–¥—ñ–≤ + ¬´–Ü–Ω—à–∞ –º–∞—Ä–∫–∞‚Ä¶¬ª
  const BRANDS={
    "Toyota":["Corolla","Camry","RAV4","Land Cruiser","Yaris","Prius","Avensis","Auris","C-HR","Highlander","Hilux"],
    "Volkswagen":["Golf","Passat","Tiguan","Polo","Touareg","Jetta","Transporter","T-Roc","Caddy","Multivan"],
    "BMW":["1 Series","2 Series","3 Series","4 Series","5 Series","7 Series","X1","X3","X5","X6","i3","i8"],
    "Mercedes-Benz":["A-Class","B-Class","C-Class","E-Class","S-Class","GLA","GLC","GLE","GLS","Vito","Sprinter"],
    "Audi":["A1","A3","A4","A6","A8","Q2","Q3","Q5","Q7","Q8","e-tron"],
    "Skoda":["Fabia","Octavia","Superb","Kodiaq","Karoq","Scala","Kamiq"],
    "Renault":["Clio","Megane","Kadjar","Duster","Kangoo","Trafic","Talisman","Captur"],
    "Hyundai":["i20","i30","Elantra","Tucson","Santa Fe","Accent","Kona","Creta","Venue"],
    "Kia":["Rio","Ceed","Sportage","Sorento","Soul","Picanto","Seltos","K5"],
    "Nissan":["Micra","Juke","Qashqai","X-Trail","Leaf","Navara","Note","Terrano"],
    "Ford":["Fiesta","Focus","Mondeo","Kuga","EcoSport","Transit","Ranger","Explorer"],
    "Opel":["Corsa","Astra","Insignia","Mokka","Zafira","Vivaro","Grandland X"],
    "Mazda":["2","3","6","CX-3","CX-5","CX-30","CX-9","MX-5"],
    "Honda":["Civic","Accord","CR-V","HR-V","Jazz","Pilot","Fit","Insight"],
    "Peugeot":["108","208","308","508","2008","3008","5008","Partner","Rifter"],
    "Citroen":["C1","C3","C4","C5","C-Elysee","Berlingo","Jumpy"],
    "Volvo":["S40","S60","S90","V40","V60","XC40","XC60","XC90"],
    "Subaru":["Impreza","Legacy","Forester","Outback","XV","BRZ"],
    "Mitsubishi":["Lancer","ASX","Outlander","Pajero","Eclipse Cross"],
    "Tesla":["Model 3","Model S","Model Y","Model X"],
    "Chevrolet":["Aveo","Cruze","Captiva","Equinox","Malibu","Spark","Tahoe"],
    "Jeep":["Renegade","Compass","Cherokee","Grand Cherokee","Wrangler"],
    "Fiat":["Panda","Punto","Tipo","Doblo","Talento","500","500X"],
    "Porsche":["Macan","Cayenne","Panamera","Taycan"],
    "Lexus":["IS","ES","GS","RX","NX","UX","LX","GX"],
    "Alfa Romeo":["Giulietta","Giulia","Stelvio","Mito"],
    "SEAT":["Ibiza","Leon","Ateca","Arona","Tarraco","Toledo"],
    "Dacia":["Logan","Sandero","Duster","Dokker","Lodgy"],
    "Land Rover":["Range Rover","Range Rover Sport","Discovery","Evoque","Defender"],
    "Jaguar":["XE","XF","XJ","F-Pace","E-Pace","I-Pace"],
    "MINI":["One","Cooper","Clubman","Countryman"],
    "Suzuki":["Swift","Vitara","SX4","Jimny","Ignis","S-Cross"],
    "Infiniti":["Q30","Q50","QX30","QX50","QX70"],
    "Acura":["ILX","TLX","RDX","MDX","NSX"],
    "Cadillac":["ATS","CTS","XT5","Escalade","SRX"],
    "Buick":["Encore","Enclave","Regal","LaCrosse"],
    "Chrysler":["200","300","Pacifica","Voyager"],
    "Dodge":["Neon","Avenger","Charger","Durango","Journey"],
    "RAM":["1500","2500","3500"],
    "GMC":["Terrain","Acadia","Yukon","Sierra"],
    "Lincoln":["MKZ","MKX","Nautilus","Aviator"],
    "Saab":["9-3","9-5"],
    "Lada":["2107","Priora","Vesta","Granta","Niva"],
    "ZAZ":["Lanos","Sens","Vida"],
    "Daewoo":["Lanos","Nexia","Matiz"],
    "Geely":["CK","Emgrand","Atlas","Coolray"],
    "Great Wall":["Hover","Wingle"],
    "BYD":["F3","Tang","Han","Atto 3"],
    "Chery":["QQ","Tiggo 2","Tiggo 4","Tiggo 7","Tiggo 8"],
    "Haval":["H2","H6","Jolion"],
    "MG":["ZS","HS","5","3","GS"],
    "SsangYong":["Kyron","Actyon","Tivoli","Korando"],
    "Rover":["25","45","75"],
    "–Ü–Ω—à–∞ –º–∞—Ä–∫–∞‚Ä¶":[]
  };

  // ===== –ì–ª–æ–±–∞–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏
  const uid=()=>Math.random().toString(16).slice(2)+Date.now().toString(16);
  const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const pick=a=>a[rand(0,a.length-1)];

  function carPNG(title, seed=0, body="–°–µ–¥–∞–Ω", colorIdx=0){
    const c=document.createElement('canvas'); c.width=800; c.height=500;
    const g=c.getContext('2d');
    const palettes=[["#0e2a58","#163b7a","#0b1d3b"],["#3a1f5d","#532e8a","#1b0f2f"],["#0b3a2e","#147a60","#06241d"],["#6b1f1f","#a23333","#240909"]];
    const pal=palettes[colorIdx%palettes.length];
    const grad=g.createLinearGradient(0,0,800,500); grad.addColorStop(0,pal[0]); grad.addColorStop(1,pal[1]);
    g.fillStyle=grad; g.fillRect(0,0,800,500); g.fillStyle=pal[2]; g.fillRect(0,400,800,100);
    g.fillStyle="rgba(0,0,0,.25)"; g.beginPath(); g.ellipse(400,390,260,40,0,0,Math.PI*2); g.fill();
    const carColors=['#ffcf33','#e74c3c','#2ecc71','#3498db','#9b59b6','#f39c12','#1abc9c','#ecf0f1']; const cc=carColors[(seed+3)%carColors.length];
    function wheel(x,y){ g.fillStyle='#111'; g.beginPath(); g.arc(x,y,48,0,Math.PI*2); g.fill(); g.fillStyle='#bbb'; g.beginPath(); g.arc(x,y,20,0,Math.PI*2); g.fill(); }
    wheel(280,380); wheel(540,380);
    g.fillStyle=cc; g.strokeStyle='#00000040'; g.lineWidth=2;
    if(body==='–ö—Ä–æ—Å–æ–≤–µ—Ä'||body==='–ü–æ–∑–∞—à–ª—è—Ö–æ–≤–∏–∫'){ g.beginPath(); g.moveTo(180,360); g.lineTo(180,330); g.lineTo(260,300); g.lineTo(430,290); g.lineTo(520,310); g.lineTo(600,330); g.lineTo(620,360); g.closePath(); g.fill(); g.stroke(); }
    else if(body==='–•–µ—Ç—á–±–µ–∫'){ g.beginPath(); g.moveTo(160,360); g.lineTo(175,330); g.lineTo(260,300); g.lineTo(420,300); g.lineTo(520,330); g.lineTo(560,360); g.closePath(); g.fill(); g.stroke(); }
    else if(body==='–ö—É–ø–µ'){ g.beginPath(); g.moveTo(170,360); g.lineTo(210,320); g.quadraticCurveTo(360,270,520,310); g.lineTo(580,360); g.closePath(); g.fill(); g.stroke(); }
    else { g.beginPath(); g.moveTo(160,360); g.lineTo(210,320); g.quadraticCurveTo(360,270,520,310); g.lineTo(600,360); g.closePath(); g.fill(); g.stroke(); }
    g.fillStyle='rgba(255,255,255,.85)'; g.fillRect(300,305,90,35); g.fillRect(400,300,100,38);
    g.fillStyle='#fff8b0'; g.fillRect(600,340,14,10); g.fillStyle='#ff5c5c'; g.fillRect(160,340,12,10);
    g.fillStyle='#ffd33b'; g.font="bold 42px 'Russo One', Arial"; g.textAlign="center"; g.fillText(title, 400, 80);
    return c.toDataURL('image/png');
  }
  function createImg(src, alt, fallback){
    const img=document.createElement("img"); img.loading="lazy"; img.alt=alt;
    img.src = src || fallback; img.onerror=()=>{ img.onerror=null; img.src=fallback; };
    return img;
  }

  // ====== –ë–∞–∑–∞: —Å–∏–¥-–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —É –ø–∞–º º—è—Ç—ñ + ¬´–µ–∫—Å—Ç—Ä–∞¬ª –≤ —Å—Ö–æ–≤–∏—â—ñ
  let SEED_COUNT=2000;
  let DB_MEM=[]; // —Å–∏–¥-–¥–∞–Ω—ñ (–Ω–µ –ø–∏—à–µ–º–æ —É storage)

  function makeSeed(){
    const out=[]; const regions=Object.keys(REGIONS); const brands=Object.keys(BRANDS); let i=0;
    while(out.length<SEED_COUNT){
      const region=regions[i%regions.length];
      const city=pick(REGIONS[region]);
      const section=pick(SECTIONS);
      const brand=brands[i%brands.length];
      const model=BRANDS[brand].length? pick(BRANDS[brand]) : "Model";
      const electric=(section==="–ï–ª–µ–∫—Ç—Ä–æ")||brand==="Tesla"||model==="Leaf";
      const year=electric?rand(2014,2025):rand(2005,2025);
      const mileage=electric?rand(0,180000):rand(10000,350000);
      const fuel=electric?"–ï–ª–µ–∫—Ç—Ä–æ":pick(FUELS.filter(f=>f!=="–ï–ª–µ–∫—Ç—Ä–æ"));
      const gear=pick(GEARS), power=electric?rand(120,450):rand(70,320);
      const price=Math.max(1200,Math.round((electric?18000:5500)+(2025-year)*500+rand(-1500,7000)));
      out.push({
        id:uid(), region, city, section, brand, model, year, mileage, fuel, gear,
        drive:pick(DRIVE), body:pick(BODIES), power, color:pick(COLORS),
        price, currency:"$", created:Date.now()-rand(0,60*86400*1000),
        views:rand(100,500), vin:(Math.random()<.25?("UA"+rand(1000000,9999999)):""),
        seller:{name:pick(["–û–ª–µ–≥","–Ü—Ä–∏–Ω–∞","–°–µ—Ä–≥—ñ–π","–ê–Ω–Ω–∞","–í—ñ–∫—Ç–æ—Ä","–ú–∞–∫—Å–∏–º","–ú–∞—Ä—ñ—è"])+" "+pick(["–ö.","–õ.","–ú.","–°.","–î."]), phone:"+380"+rand(500000000,999999999)},
        desc:"–ì–∞—Ä–Ω–∏–π —Å—Ç–∞–Ω, —á–µ—Å–Ω–∏–π –ø—Ä–æ–±—ñ–≥. –¢–û –≤—á–∞—Å–Ω–æ. –î–µ—Ç–∞–ª—ñ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.",
        images:[]
      });
      i++;
    }
    DB_MEM=out;
  }
  makeSeed();

  function extrasGet(){
    try{ const raw = SAFE.get(EXTRA_KEY); return raw? JSON.parse(raw): []; }catch{ return []; }
  }
  function extrasSet(list){
    try{ SAFE.set(EXTRA_KEY, JSON.stringify(list)); }
    catch{ /* —Ñ–æ–ª–±–µ–∫ —É—Å–µ—Ä–µ–¥–∏–Ω—ñ SAFE.set */ }
  }

  function getDB(){ return DB_MEM.concat(extrasGet()); }

  // ====== UI-–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
  const fltRegion=$("#fltRegion"), fltCity=$("#fltCity"), fltCityText=$("#fltCityText"), cityDL=$("#cityDL");
  const fltBrand=$("#fltBrand"), fltModel=$("#fltModel");
  const fltYearMin=$("#fltYearMin"), fltYearMax=$("#fltYearMax"), fltFuel=$("#fltFuel"), fltGear=$("#fltGear"),
        fltDrive=$("#fltDrive"), fltBody=$("#fltBody"), fltColor=$("#fltColor"),
        fltPowerMin=$("#fltPowerMin"), fltQuery=$("#fltQuery"), fltRecent=$("#fltRecent");

  function fillSelect(el, arr, withAll=true, txt="–ë—É–¥—å-—è–∫–∏–π"){
    el.innerHTML=(withAll?`<option value="">${txt}</option>`:'')+arr.map(x=>`<option value="${x}">${x}</option>`).join('');
  }
  // Regions/cities
  const ALL_CITIES=Object.values(REGIONS).flat();
  fillSelect(fltRegion, Object.keys(REGIONS));
  function refreshCities(){
    const region=fltRegion.value;
    const list = region? REGIONS[region] : ALL_CITIES;
    fillSelect(fltCity, list, true, "–ë—É–¥—å-—è–∫–µ");
  }
  refreshCities();
  cityDL.innerHTML=ALL_CITIES.map(c=>`<option value="${c}">`).join('');
  fltCityText.addEventListener('input', ()=>{
    const v=fltCityText.value.trim();
    if(!v) return;
    for(const [reg, arr] of Object.entries(REGIONS)){
      if(arr.includes(v)){ fltRegion.value=reg; refreshCities(); fltCity.value=v; break; }
    }
  });
  fltRegion.addEventListener('change', refreshCities);

  // Brands/models
  fillSelect(fltBrand,Object.keys(BRANDS));
  function refreshModels(){ const b=fltBrand.value; fillSelect(fltModel, b?BRANDS[b]:[], true, "–ë—É–¥—å-—è–∫–∞"); }
  refreshModels(); fltBrand.addEventListener('change', refreshModels);

  // Other selects
  fillSelect(fltFuel,FUELS); fillSelect(fltGear,GEARS);
  fillSelect(fltDrive,DRIVE); fillSelect(fltBody,BODIES); fillSelect(fltColor,COLORS);
  fillSelect(fltYearMin,YEARS); fillSelect(fltYearMax,YEARS);

  // –ö–∞—Å—Ç–æ–º-—Å–µ–ª–µ–∫—Ç–∏ (–¥–µ—Å–∫—Ç–æ–ø)
  function enhanceSelect(sel){
    if (matchMedia('(hover: none)').matches) return;
    if (sel.classList.contains('nice-hidden')) return;
    const wrap=document.createElement('div'); wrap.className='nice';
    const btn=document.createElement('button'); btn.type='button'; btn.className='nice-btn';
    const list=document.createElement('div'); list.className='nice-list';
    const opts=[...sel.options];
    function refreshBtn(){ btn.textContent = opts[sel.selectedIndex]?.text || (sel.getAttribute('data-placeholder')||'–í–∏–±–µ—Ä—ñ—Ç—å'); }
    opts.forEach((o, idx)=>{
      const it=document.createElement('div'); it.className='nice-item'+(o.selected?' active':''); it.textContent=o.text;
      it.onclick=(e)=>{ e.stopPropagation(); sel.selectedIndex=idx; refreshBtn(); [...list.children].forEach(c=>c.classList.remove('active')); it.classList.add('active'); closeAll(); sel.dispatchEvent(new Event('change')); };
      list.appendChild(it);
    });
    sel.classList.add('nice-hidden');
    sel.parentNode.insertBefore(wrap, sel);
    wrap.appendChild(sel); wrap.appendChild(btn); wrap.appendChild(list);
    refreshBtn();
    btn.onclick=(e)=>{ e.stopPropagation(); closeAll(); wrap.classList.toggle('open'); };
  }
  function closeAll(){ $$('.nice.open').forEach(n=>n.classList.remove('open')); }
  document.addEventListener('click', closeAll);
  $$('.select').forEach(enhanceSelect);

  // ===== –ü–ê–ì–Ü–ù–ê–¶–Ü–Ø
  const grid=$("#grid"), resCount=$("#resCount"), sortBy=$("#sortBy");
  const pager=$("#pager"), pgPrev=$("#pgPrev"), pgNext=$("#pgNext"), pgInfo=$("#pgInfo");
  let page=1, pageSize=50, results=[], totalPages=1;

  function applyFilters(){
    const q=(fltQuery.value||"").trim().toLowerCase();
    const pmin= +($("#fltPriceMin").value||0);
    const pmax= +($("#fltPriceMax").value||0);
    const mmax= +($("#fltMileageMax").value||0);
    const powMin = +((fltPowerMin.value||0));

    const cityText = fltCityText.value.trim();
    const region = fltRegion.value;
    const city = fltCity.value || (ALL_CITIES.includes(cityText)? cityText : "");

    let arr=getDB().filter(it=>
      (!region || it.region===region) &&
      (!city || it.city===city) &&
      (!fltBrand.value || it.brand===fltBrand.value) &&
      (!fltModel.value || it.model===fltModel.value) &&
      (!fltFuel.value || it.fuel===fltFuel.value) &&
      (!fltGear.value || it.gear===fltGear.value) &&
      (!fltDrive.value || it.drive===fltDrive.value) &&
      (!fltBody.value || it.body===fltBody.value) &&
      (!fltColor.value || it.color===fltColor.value) &&
      (!fltYearMin.value || it.year>=+fltYearMin.value) &&
      (!fltYearMax.value || it.year<=+fltYearMax.value) &&
      (!pmin || it.price>=pmin) &&
      (!pmax || it.price<=pmax) &&
      (!mmax || (it.mileage/1000)<=mmax) &&
      (!powMin || it.power>=powMin) &&
      (!q || ( (it.brand+' '+it.model+' '+(it.vin||'')).toLowerCase().includes(q) )) &&
      (!fltRecent.checked || (Date.now()-it.created)<=30*86400*1000)
    );

    arr.sort((a,b)=>{
      switch(sortBy.value){
        case "priceAsc": return a.price-b.price;
        case "priceDesc": return b.price-a.price;
        case "yearDesc": return b.year-a.year;
        case "mileageAsc": return a.mileage-b.mileage;
        case "powerDesc": return b.power-a.power;
        case "viewsDesc": return b.views-a.views;
        default: return b.created-a.created;
      }
    });

    results=arr; totalPages=Math.max(1, Math.ceil(results.length/pageSize)); page=1;
    resCount.textContent=`${arr.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤`;
    renderPage();
  }

  function renderPage(){
    grid.innerHTML="";
    const start=(page-1)*pageSize, end=start+pageSize;
    results.slice(start,end).forEach(renderCard);
    pgInfo.textContent=`–°—Ç–æ—Ä—ñ–Ω–∫–∞ ${page} / ${totalPages}`;
    pgPrev.disabled = page<=1; pgNext.disabled = page>=totalPages;
    window.scrollTo({top:0,behavior:"smooth"});
  }

  function renderCard(it){
    const el=document.createElement('article'); el.className="card"; el.setAttribute('role','button'); el.title="–î–∏–≤–∏—Ç–∏—Å—è";
    const fallback=carPNG(`${it.brand} ${it.model}`, (it.year+it.price)%7, it.body, (it.power+it.year)%4);
    const firstImg=(Array.isArray(it.images)&&it.images.length)?it.images[0]:null;

    el.innerHTML=`
      <div class="thumb">
        <div class="badge">${it.price.toLocaleString('uk-UA')} ${it.currency||"$"}</div>
        <div class="views">üëÅ ${it.views||0}</div>
      </div>
      <div class="body">
        <div class="title">${it.brand} ${it.model} ‚Ä¢ ${it.year}</div>
        <div class="meta">${it.city}, ${it.region} ‚Ä¢ ${it.section}</div>
        <div class="meta">${(it.mileage/1000|0)} —Ç–∏—Å.–∫–º ‚Ä¢ ${it.fuel} ‚Ä¢ ${it.ge–∞—Ä||it.gear}</div>
      </div>`;
    el.querySelector(".thumb").prepend(createImg(firstImg, `${it.brand} ${it.model}`, fallback));
    el.onclick=()=>openDetail(it.id);
    grid.appendChild(el);
  }

  $("#btnApply").onclick=applyFilters;
  $("#btnReset").onclick=()=>{$$("#searchPanel .select, #searchPanel .input").forEach(x=>x.value=""); fltRecent.checked=false; refreshCities(); refreshModels(); applyFilters();};
  $("#sortBy").onchange=()=>{ applyFilters(); };
  pgPrev.onclick=()=>{ if(page>1){ page--; renderPage(); } };
  pgNext.onclick=()=>{ if(page<totalPages){ page++; renderPage(); } };
  applyFilters();

  // ===== –î–µ—Ç–∞–ª—å
  function spec(k,v){return `<div class="spec"><div class="h">${k}</div>${v}</div>`}
  function openDetail(id){
    const db=getDB(); const idx=db.findIndex(x=>x.id===id); if(idx<0) return;
    const it=db[idx];

    // views –ª–∏—à–µ –≤ –ø–∞–º'—è—Ç—ñ (–Ω–µ –ø–∏—à–µ–º–æ 2–∫ –∑–∞–ø–∏—Å—ñ–≤ —É storage)
    if(DB_MEM.some(x=>x.id===id)){ DB_MEM[idx].views=(DB_MEM[idx].views||0)+1; }
    else{
      const ext = extrasGet(); const j = ext.findIndex(x=>x.id===id);
      if(j>-1){ ext[j].views=(ext[j].views||0)+1; extrasSet(ext); }
    }

    const d=$("#detail"); d.classList.add('active');
    $("#dClose").onclick=()=>{ d.classList.remove('active'); renderPage(); };

    $("#dHeader").innerHTML=`
      <div class="title" style="font:700 20px/1.2 'Russo One'">${it.brand} ${it.model} ${it.year}</div>
      <div class="pill yellow">${it.price.toLocaleString('uk-UA')} ${it.currency||"$"}</div>
      <div class="pill" style="margin-left:auto">üëÅ ${(it.views||0)+1}</div>
    `;

    const imgs=(Array.isArray(it.images)&&it.images.length)?it.images:[null,null,null];
    const f1=carPNG(`${it.brand} ${it.model}`,0,it.body,0), f2=carPNG(`${it.brand} ${it.model}`,1,it.body,1), f3=carPNG(`${it.brand} ${it.model}`,2,it.body,2);

    $("#dGal").innerHTML=`
      <div class="big"></div>
      <div class="sm">
        <div style="position:relative; padding-top:56%; background:#0b3a8a; border-radius:12px; overflow:hidden"></div>
        <div style="position:relative; padding-top:56%; background:#0b3a8a; border-radius:12px; overflow:hidden"></div>
      </div>`;
    $("#dGal").querySelector(".big").appendChild(createImg(imgs[0],`${it.brand}`,f1));
    const sm=$("#dGal").querySelectorAll(".sm>div");
    sm[0].appendChild(createImg(imgs[1],`${it.brand}`,f2));
    sm[1].appendChild(createImg(imgs[2],`${it.brand}`,f3));

    $("#dSpecs").innerHTML=`
      ${spec("–û–±–ª–∞—Å—Ç—å",it.region)} ${spec("–ú—ñ—Å—Ç–æ",it.city)} ${spec("–†–æ–∑–¥—ñ–ª",it.section)} ${spec("–ü—Ä–æ–±—ñ–≥",(it.mileage/1000|0)+" —Ç–∏—Å.–∫–º")}
      ${spec("–ü–∞–ª–∏–≤–æ",it.fuel)} ${spec("–ö–æ—Ä–æ–±–∫–∞",it.ge–∞—Ä||it.gear)} ${spec("–ü—Ä–∏–≤—ñ–¥",it.drive)}
      ${spec("–ö—É–∑–æ–≤",it.body)} ${spec("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å",it.power+" –∫.—Å.")} ${spec("–ö–æ–ª—ñ—Ä",it.color)} ${spec("VIN",it.vin||"‚Äî")}
    `;
    $("#dDesc").textContent = it.desc||"";
    $("#dSeller").innerHTML=`<div class="avatar">${(it.seller?.name||"–ü")[0]}</div>
      <div><div class="h">–ü—Ä–æ–¥–∞–≤–µ—Ü—å</div><div>${it.seller?.name||"–ü—Ä–æ–¥–∞–≤–µ—Ü—å"}</div><div class="small">${it.seller?.phone||""}</div></div>`;
  }

  // ===== –ú–æ–¥–∞–ª–∫–∞ ¬´–î–æ–¥–∞—Ç–∏¬ª
  const addModal=$("#addModal");
  $("#btnOpenAdd").onclick=()=>{ addModal.classList.add('active'); };
  $("#btnCloseAdd").onclick=()=>{ addModal.classList.remove('active'); };

  // –§–æ—Ä–º–∞ ¬´–¥–æ–¥–∞—Ç–∏¬ª
  const mapSelectData={sCity:Object.values(REGIONS).flat(), sSection:SECTIONS, sFuel:FUELS, sGear:GEARS, sDrive:DRIVE, sBody:BODIES, sColor:COLORS, sBrand:Object.keys(BRANDS)};
  function fillSelectSimple(el, arr){ el.innerHTML=arr.map(x=>`<option value="${x}">${x}</option>`).join(''); }
  Object.keys(mapSelectData).forEach(id=>fillSelectSimple($("#"+id), mapSelectData[id]));
  fillSelectSimple($("#sModel"), []);
  $("#sBrand").addEventListener("change", ()=>{
    const b=$("#sBrand").value;
    $("#brandOtherWrap").style.display = (b==="–Ü–Ω—à–∞ –º–∞—Ä–∫–∞‚Ä¶")?"block":"none";
    fillSelectSimple($("#sModel"), BRANDS[b]||[]);
  });

  function getCtrl(){ try{ return JSON.parse(SAFE.get(CTRL_KEY)||"{}"); }catch{ return {} } }
  function setCtrl(v){ SAFE.set(CTRL_KEY, JSON.stringify(v)); }

  $("#sSave").onclick=()=>{
    const ctrl=getCtrl(); const now=Date.now();
    if(ctrl.lastPost && now-ctrl.lastPost<60000){ alert("–ü—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –º–æ–∂–Ω–∞ –Ω–µ —á–∞—Å—Ç—ñ—à–µ 1 —Ä–∞–∑—É –Ω–∞ 60 —Å–µ–∫."); return; }
    const city=$("#sCity").value, section=$("#sSection").value;
    let brand=$("#sBrand").value; if(brand==="–Ü–Ω—à–∞ –º–∞—Ä–∫–∞‚Ä¶"){ brand=($("#sBrandOther").value||"Other").trim(); if(!brand) return alert("–í–∫–∞–∂—ñ—Ç—å –º–∞—Ä–∫—É."); }
    const model=$("#sModel").value || "Model";
    if(!city||!section||!brand) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –º—ñ—Å—Ç–æ/—Ä–æ–∑–¥—ñ–ª/–º–∞—Ä–∫—É.");
    const year=+($("#sYear").value||0); if(!(year>=1990 && year<=2025)) return alert("–†—ñ–∫ 1990‚Äì2025.");
    const price=+($("#sPrice").value||0); if(!(price>=500 && price<=500000)) return alert("–¶—ñ–Ω–∞ $500‚Äì500000.");
    const phone=$("#sPhone").value.trim(); if(!/^\+?\d[\d\s\-]{8,}$/.test(phone)) return alert("–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π.");
    const vin=$("#sVIN").value.trim(); if(vin && !/^[A-HJ-NPR-Z0-9]{8,17}$/i.test(vin)) return alert("VIN 8‚Äì17 —Å–∏–º–≤–æ–ª—ñ–≤.");
    const desc=$("#sDesc").value.trim(); if(desc.length<20) return alert("–û–ø–∏—Å ‚â• 20 —Å–∏–º–≤–æ–ª—ñ–≤.");

    const mileage=+($("#sMileage").value||0), fuel=$("#sFuel").value, gear=$("#sGear").value,
          drive=$("#sDrive").value, body=$("#sBody").value, color=$("#sColor").value, power=+($("#sPower").value||100);
    const images=($("#sImages").value||"").split(",").map(s=>s.trim()).filter(Boolean).slice(0,3);

    const ext=extrasGet();
    if(vin && (ext.some(x=>x.vin && x.vin===vin) || DB_MEM.some(x=>x.vin && x.vin===vin))) return alert("–ê–≤—Ç–æ –∑ —Ç–∞–∫–∏–º VIN –≤–∂–µ —ñ—Å–Ω—É—î.");

    ext.unshift({
      id:uid(), region:"", city, section, brand, model, year, mileage, fuel, gear, drive, body, power, color,
      price, currency:"$", created: now, vin, seller:{name:"–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –ø—Ä–æ–¥–∞–≤–µ—Ü—å", phone}, desc, views: rand(5,25), images
    });
    extrasSet(ext); ctrl.lastPost=now; setCtrl(ctrl);
    alert("–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ.");
    addModal.classList.remove('active');
    applyFilters();
  };

  // ===== –Ü–º–ø–æ—Ä—Ç JSON (–º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤ —Ñ–æ—Ä–º–∞—Ç—É, –æ–ø–∏—Å–∞–Ω–æ–≥–æ –Ω–∏–∂—á–µ)
  document.getElementById("importJson").addEventListener("change", async (e)=>{
    const f=e.target.files?.[0]; if(!f) return;
    try{
      const arr=JSON.parse(await f.text());
      if(!Array.isArray(arr)) throw new Error("JSON –º–∞—î –±—É—Ç–∏ –º–∞—Å–∏–≤–æ–º");
      const ext=extrasGet();
      arr.forEach(o=>{
        ext.push({
          id:uid(), region:o.region||"", city:o.city||"–ö–∏—ó–≤", section:o.section||"–õ–µ–≥–∫–æ–≤—ñ",
          brand:o.brand||"Brand", model:o.model||"Model", year:+o.year||2020, mileage:+o.mileage||rand(10000,200000),
          fuel:o.fuel||"–ë–µ–Ω–∑–∏–Ω", gear:o.gear||"–ê–≤—Ç–æ–º–∞—Ç", drive:o.drive||"FWD", body:o.body||"–°–µ–¥–∞–Ω",
          power:+o.power||120, color:o.color||"–°—ñ—Ä–∏–π", price:+o.price||10000, currency:o.currency||"$",
          created:+o.created||Date.now(), vin:o.vin||"", seller:o.seller||{name:"–Ü–º–ø–æ—Ä—Ç", phone:"+380"},
          desc:o.desc||"–Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è.", images:Array.isArray(o.images)?o.images.slice(0,3):[], views:+o.views||rand(150,500)
        });
      });
      extrasSet(ext);
      applyFilters(); alert("–Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!");
    }catch(err){ alert("–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É: "+err.message); }
    e.target.value="";
  });

  // –û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—É –±–∞–∑—É (–Ω–∞ –≤–∏–ø–∞–¥–æ–∫ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è)
  document.getElementById("btnClear").onclick=()=>{
    SAFE.del(EXTRA_KEY); SAFE.del(CTRL_KEY);
    alert("–õ–æ–∫–∞–ª—å–Ω–∞ –±–∞–∑–∞ –≤–∏–¥–∞–ª–µ–Ω–∞. –°–∏–¥-–¥–∞–Ω—ñ (2000) –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è."); applyFilters();
  };
  </script>
</body>
</html>
